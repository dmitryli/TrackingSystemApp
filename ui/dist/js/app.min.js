"use strict";angular.module("pTrack",["ngRoute","ngResource","angular.filter","ngAnimate","ui.bootstrap","ptControllers","ptFilters","ptDirectives","ptServices"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/home",{templateUrl:"views/home.html",controller:"HomeController"}).when("/deliveries",{templateUrl:"views/deliveries.html",controller:"DeliveriesController"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsController"}).when("/feedback",{templateUrl:"views/feedback.html",controller:"FeedbackController"}).when("/about",{templateUrl:"views/about.html",controller:"AboutController"}).otherwise({redirectTo:"/home"})}]).value("currentUser",{user:null});
"use strict";var ptControllers=angular.module("ptControllers",[]);ptControllers.controller("NavController",["$scope","$location","AuthService","currentUser",function(e,r,t,o){e.menuClass=function(e){var t=r.path().substring(1);return e===t?"active":""},e.logout=function(){t.logout()},e.currentUser=o}]),ptControllers.controller("HomeController",["$scope","currentUser",function(e,r){e.$watch("isLoggedIn",function(t){e.title=e.isLoggedIn?"Welcome to pTrack "+r.user.displayName:"Welcome to pTrack"})}]),ptControllers.controller("AboutController",["$scope",function(e){}]),ptControllers.controller("SignInController",["$scope","$http","AuthService","Users","Store","Base64",function(e,r,t,o,n,s){e.account={userName:n.get("userName"),password:""},e.rememberMe=n.get("rememberMe")||!1,e.signin=function(){var i=s.encode(e.account.userName+":"+e.account.password);r.defaults.headers.common.Authorization="Basic "+i,o.signin({email:e.account.userName}).$promise.then(function(r){e.loginFrm.$setValidity("auth",!0),e.rememberMe?(n.set("userName",e.account.userName),n.set("rememberMe",!0)):(n.set("userName",null),n.set("rememberMe",!1)),r&&r.href&&t.login(r.href)},function(r){e.loginFrm.$setValidity("auth",!1),e.loginFrm.$setValidity()})}}]),ptControllers.controller("SignUpController",["$scope","Registration","AuthService",function(e,r,t){e.newAccount={userName:"",email:"",password:""},e.password2="",e.signup=function(){e.newAccount.password!==e.password2?(e.signupFrm.password.$setValidity("password",!1),e.$watch(function(){return e.newAccount.password===e.password2},function(r,t){r===!0&&e.signupFrm.password.$setValidity("password",!0)})):(e.signupFrm.password.$setValidity("password",!0),e.signupFrm.$valid&&r.create({displayName:e.newAccount.userName,email:e.newAccount.email,password:e.newAccount.password}).$promise.then(function(e){var r="";if(e&&e.length>0){for(var o=0;o<e.length;o++)if("user"===e[o].rel){r=e[o].href;break}r&&t.login(r)}}))}}]),ptControllers.controller("DeliveriesController",["$scope","currentUser","Deliveries","$modal","DeliveriesCounters",function(e,r,t,o,n){function s(r){return 0===e.counters[r]}e.title="Home",e.carrier="",e.showModal=!1,e.filterByState="ACTIVE",e.status="overdue",e.currentTime=Date.now(),e.isEmptyList=!0,e.counters={overdue:0,onTrack:0,archived:0},e.selectCarrier=function(r){e.carrier=r},e.changeStatus=function(r){e.status=r,e.isEmptyList=s(r)},e.sortedStatus=function(e){switch(e.deliveryStatus){case"INTRANSIT":return 1;case"DELIVERED":return 2;case"UNKNOWN":return 3}},e.loadOrders=function(){t.query({accountId:r.user.accountId},function(r){e.deliveries=r,e.counters=n.counters(r),e.isEmptyList=s(e.status)})},e.loadOrders(),e.showHideDeliveryDetails=function(e){e.isDetailsOpen=e.isDetailsOpen?!1:!0},e.showAddDelivery=function(){o.open({templateUrl:"views/addDelivery.html",controller:"AddDeliveryController",size:"md"}).result.then(function(r){e.loadOrders()})}}]),ptControllers.controller("DeliveryProgressController",["$scope","currentUser","Deliveries",function(e,r,t){function o(e,r){return r?e>r?100:e/r*100:0}var n=e.delivery.creationTime,s=e.currentTime-n,i=60*e.delivery.threshold*60*1e3,a=2*i,c=o(s,a);e.thresholdTime=new Date(n+i),e.progress={max:100,onTrack:49>c?c:49,negOnTrack:49>c?49-c:0,overdue:c>50?c-50:0},e.open=function(r){r.preventDefault(),r.stopPropagation(),e.opened=!0},e.dateOptions={formatDay:"dd",formatMonth:"MM",formatYear:"yyyy",startingDay:1},e.format="MM/dd/yyyy",e.changeTreshold=function(o){t.updateThreshold({accountId:r.user.accountId,deliveryId:e.delivery.id},{threshold:e.delivery.threshold+24*o}).$promise.then(function(){e.loadOrders()})},e.updateMute=function(){t.updateMute({accountId:r.user.accountId,deliveryId:e.delivery.id},{muteNotifications:!e.delivery.muteNotifications}).$promise.then(function(){e.loadOrders()})},e.archived=function(){t.updateArchived({accountId:r.user.accountId,deliveryId:e.delivery.id},{state:"ARCHIVED"}).$promise.then(function(){e.loadOrders()})}}]),ptControllers.controller("AddDeliveryController",["$scope","$modalInstance","Deliveries","currentUser",function(e,r,t,o){e.frm={description:"",trackingId:"",carrier:"",threshold:0},e.add=function(){if(e.addForm.$valid){var n=new t;n.deliveries=[{id:e.frm.trackingId,description:e.frm.description,carrier:e.frm.carrier.toUpperCase(),threshold:24*e.frm.threshold}],t.add({accountId:o.user.accountId},n).$promise.then(function(e){r.close(e)})}},e.cancel=function(){r.dismiss("cancel")}}]),ptControllers.controller("SettingsController",["$scope","currentUser","Users",function(e,r,t){var o={displayName:"",email:"",phoneNumber:"",password:null,emailWhenNewOrderAdded:!0,emailWhenOrderStateChanges:!0,emailWhenThresholdExceeded:!0,emailNotificationTime:0,defaultThreshold:{USPS:96,UPS:96},accountId:"",accountLink:{rel:"account",href:"http://localhost:8080/tracking/accounts/"}};e.title="Settings",e.tresholds=[{value:24,text:"1 day"},{value:48,text:"2 days"},{value:72,text:"3 days"},{value:96,text:"4 days"},{value:120,text:"5 days"},{value:144,text:"6 days"},{value:168,text:"1 week"}],e.profile=o,e.ups=48,e.usps=96,t.get({userId:r.user.id},function(r){e.profile=r}),e.reset=function(){t.get({userId:r.user.id},function(r){e.profile=r})},e.update=function(){e.frmProfile.$valid&&t.update({userId:r.user.id},e.profile)}}]),ptControllers.controller("FeedbackController",["$scope","Feedback","currentUser",function(e,r,t){e.frm={text:""},e.isSent=!1,e.sendFeedback=function(){if(e.fbForm.$valid){var o=new r({text:e.frm.text,sourceAccoundId:t.user.accountId});o.$save().then(function(){e.isSent=!0})}}}]);
"use strict";var ptDirectives=angular.module("ptDirectives",[]);ptDirectives.directive("ptCarrierLink",function(){var r={UPS:"http://wwwapps.ups.com/WebTracking/processRequest?tracknum=",USPS:"https://tools.usps.com/go/TrackConfirmAction.action?tLabels="};return{restrict:"A",link:function(e,t,i,s){var c=r[e.delivery.carrier]+e.delivery.id;t.attr("href",c)}}}),ptDirectives.directive("ptCarrierLogo",function(){var r={FEDEX:"images/fedex-logo.png",UPS:"images/ups-logo.png",USPS:"images/usps-logo2.png"};return{restrict:"A",link:function(e,t,i,s){var c=r[e.delivery.carrier];t.attr("src",c)}}});
"use strict";var ptFilters=angular.module("ptFilters",[]);ptFilters.filter("DeliveryStatus",function(){return function(e,t){var r,n,s=[];if(e&&e.length>0)switch(t){case"overdue":for(n=0;n<e.length;n++)r=e[n],"ACTIVE"===r.state&&r.overDue&&s.push(r);break;case"on-track":for(n=0;n<e.length;n++)r=e[n],"ACTIVE"!==r.state||r.overDue||s.push(r);break;case"archived":for(n=0;n<e.length;n++)r=e[n],"ARCHIVED"===r.state&&s.push(r)}return s}}),ptFilters.filter("StatusFormat",function(){return function(e){switch(e){case"INTRANSIT":return"In-Transit";case"DELIVERED":return"Delivered";case"UNKNOWN":return"Unknown"}}});
"use strict";var ptServices=angular.module("ptServices",["ngResource"]);ptServices.factory("Deliveries",["$resource",function(e){return e("tracking/accounts/:accountId/deliveries",null,{add:{method:"POST",isArray:!0},updateThreshold:{method:"POST",isArray:!1,url:"tracking/accounts/:accountId/deliveries/:deliveryId/threshold"},updateMute:{method:"POST",isArray:!1,url:"tracking/accounts/:accountId/deliveries/:deliveryId/mute"},updateArchived:{method:"POST",isArray:!1,url:"tracking/accounts/:accountId/deliveries/:deliveryId/state"}})}]),ptServices.service("DeliveriesCounters",["$filter",function(e){this.counters=function(r){return{overdue:e("DeliveryStatus")(r,"overdue").length,onTrack:e("DeliveryStatus")(r,"on-track").length,archived:e("DeliveryStatus")(r,"archived").length}}}]),ptServices.factory("Registration",["$resource",function(e){return e("tracking/registration",null,{create:{method:"POST",isArray:!0}})}]),ptServices.factory("Users",["$resource",function(e){return e("tracking/users/:userId",null,{update:{method:"POST"},signin:{method:"GET",isArray:!1,url:"tracking/users?email=:email"}})}]),ptServices.factory("AuthService",["$location","Users","Store","currentUser","$rootScope",function(e,r,t,n,o){var i=t.getFromSession("currentUser");return i&&(n.user=i,o.isLoggedIn=!0),{login:function(i){var c=i.split("/"),a=c[c.length-1];r.get({userId:a},function(r){n.user=r,t.setToSession("currentUser",r),o.isLoggedIn=!0,e.path("deliveries")})},logout:function(){n.user=null,t.setToSession("currentUser",null),o.isLoggedIn=!1,e.path("home")}}}]),ptServices.factory("Store",["$window",function(e){return{set:function(r,t){e.localStorage.setItem(r,angular.toJson(t,!0))},get:function(r){return angular.fromJson(e.localStorage.getItem(r))},setToSession:function(r,t){e.sessionStorage.setItem(r,angular.toJson(t,!0))},getFromSession:function(r){return angular.fromJson(e.sessionStorage.getItem(r))}}}]),ptServices.factory("Feedback",["$resource",function(e){return e("tracking/feedbacks")}]),ptServices.factory("Auth",["userId",function(e){return{isLoggedIn:function(){return""!==e.value}}}]),ptServices.factory("Base64",function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(r){var t,n,o,i,c,a="",s="",u="",d=0;do t=r.charCodeAt(d++),n=r.charCodeAt(d++),s=r.charCodeAt(d++),o=t>>2,i=(3&t)<<4|n>>4,c=(15&n)<<2|s>>6,u=63&s,isNaN(n)?c=u=64:isNaN(s)&&(u=64),a=a+e.charAt(o)+e.charAt(i)+e.charAt(c)+e.charAt(u),t=n=s="",o=i=c=u="";while(d<r.length);return a},decode:function(r){var t,n,o,i,c,a="",s="",u="",d=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(r)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),r=r.replace(/[^A-Za-z0-9\+\/\=]/g,"");do o=e.indexOf(r.charAt(d++)),i=e.indexOf(r.charAt(d++)),c=e.indexOf(r.charAt(d++)),u=e.indexOf(r.charAt(d++)),t=o<<2|i>>4,n=(15&i)<<4|c>>2,s=(3&c)<<6|u,a+=String.fromCharCode(t),64!=c&&(a+=String.fromCharCode(n)),64!=u&&(a+=String.fromCharCode(s)),t=n=s="",o=i=c=u="";while(d<r.length);return a}}});